# 命理图表可视化工具使用说明

## 功能简介

`chart_visualizer.py` 是一个强大的命理图表可视化工具，可以根据 `triple_chart_parser.py` 生成的JSON数据，自动生成精美的图表：

- **八字排盘图**：四柱结构，含天干地支、藏干、十神、日主高亮等
- **紫微斗数命盘图**：12宫格布盘，标注主星、副星、四化飞星、命宫等  
- **印度星盘图**：南印度样式，显示Asc、各星体位置、星座、宫位

## 安装依赖

确保已安装所有必要的依赖：

```bash
pip install -r requirements.txt
```

新增的依赖包括：
- `matplotlib` - 图表绘制库
- `numpy` - 数值计算库

## 使用方法

### 基本使用

```bash
# 生成所有三种图表（默认）
python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json

# 指定输出目录
python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json --output-dir ./charts

# 只生成特定类型的图表
python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json --chart-type bazi
python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json --chart-type ziwei
python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json --chart-type vedic
```

### 参数说明

- `json_file`：必需，JSON排盘数据文件路径
- `--output-dir, -o`：可选，输出目录（默认为JSON文件所在目录）
- `--chart-type, -t`：可选，图表类型
  - `all`：生成所有图表（默认）
  - `bazi`：只生成八字排盘图
  - `ziwei`：只生成紫微斗数命盘图
  - `vedic`：只生成印度星盘图

## 输出文件

生成的图片文件会以原JSON文件名为基础，添加图表类型后缀：

```
{原文件名}_八字排盘图.png
{原文件名}_紫微斗数命盘图.png
{原文件名}_印度星盘图.png
```

例如：
```
1_20000101_0000_北京_116.4_39.9_八字排盘图.png
1_20000101_0000_北京_116.4_39.9_紫微斗数命盘图.png
1_20000101_0000_北京_116.4_39.9_印度星盘图.png
```

## 图表特点

### 八字排盘图
- **四柱布局**：年柱、月柱、日柱、时柱垂直排列
- **颜色编码**：
  - 天干：浅蓝色背景
  - 地支：浅绿色背景
  - 十神：浅黄色背景
  - 藏干：浅青色背景
- **日主高亮**：日柱天干用红色标注
- **详细信息**：包含五行统计、身强身弱分析
- **图例说明**：清晰的颜色图例和术语解释

### 紫微斗数命盘图
- **12宫布局**：传统的12宫方格排列
- **主星显示**：主星用红色粗体标注，包含亮度信息
- **副星标注**：副星用蓝色小字显示
- **身宫标记**：身宫用黄色圆圈"身"字标记
- **中央信息**：命主星、身主星、五行局显示在中央
- **农历日期**：底部显示对应的农历日期

### 印度星盘图
- **南印度样式**：传统的菱形12宫布局
- **宫位标注**：每个宫位清晰标注（Asc, 2nd, 3rd等）
- **行星符号**：使用标准的天体符号
- **星座信息**：显示各行星所在星座
- **图例说明**：底部提供符号对照表

## 完整工作流程

1. **生成排盘数据**：
   ```bash
   python triple_chart_parser.py --birth-date 2000-01-01 --birth-time 00:00 --timezone +8 --longitude 116.4 --latitude 39.9 --gender 1 --save-file --location 北京
   ```

2. **生成可视化图表**：
   ```bash
   python chart_visualizer.py 1_20000101_0000_北京_116.4_39.9.json
   ```

3. **查看结果**：
   - JSON数据文件：包含详细的排盘计算结果
   - PNG图片文件：包含美观的可视化图表

## 技术特点

- **高分辨率输出**：300 DPI，适合打印和高质量显示
- **中文字体支持**：自动处理中文显示
- **自适应布局**：根据数据内容自动调整布局
- **错误处理**：完善的错误提示和异常处理
- **模块化设计**：每种图表独立生成，便于维护

## 故障排查

### 字体警告
如果看到类似 "Glyph missing from font" 的警告，这是正常现象，不影响图片生成。这是因为某些特殊符号（如天体符号）在默认中文字体中不存在。

### 依赖问题
```bash
# 如果遇到导入错误，确保安装了所有依赖
pip install matplotlib numpy

# 如果在虚拟环境中，确保已激活
.\venv\Scripts\Activate.ps1  # Windows
source venv/bin/activate     # Mac/Linux
```

### 文件路径问题
- 确保JSON文件路径正确
- 确保有输出目录的写入权限

## 示例输出

使用2000年1月1日零点北京的案例，会生成：

1. **八字排盘图**：显示己卯年丙子月丁巳日庚子时的完整四柱信息
2. **紫微斗数命盘图**：显示水二局、贪狼命、天同身的12宫布局
3. **印度星盘图**：显示各行星在12宫位的分布情况

每个图表都包含丰富的命理信息，便于分析和解读。 